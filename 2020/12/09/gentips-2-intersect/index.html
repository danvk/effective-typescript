<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>Generic Tips Part 2: Intersect what you have with whatever TypeScript wants</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Khula:wght@600&family=Open+Sans:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&display=swap" rel="stylesheet">
    <link href="/css/customize.css" rel="stylesheet">
    <link href="/css/highlight.vs.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/icon.png">
    <meta name="description" content="Effective TypeScript: Generic Tips Part 2: Intersect what you have with whatever TypeScript wants">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@danvdk">
    <meta name="twitter:domain" content="effectivetypescript.com">
    <meta name="twitter:title" content="Effective TypeScript &rsaquo; Generic Tips Part 2: Intersect what you have with whatever TypeScript wants">
    <meta name="twitter:description" content="When you&#39;re working with generic types and run into a seemingly unavoidable error, there&#39;s a trick that can often make it go away: intersect what you have with whatever TypeScript wants it to be. Your errors will melt away! Read on for examples and caveats.
">
    <meta name="twitter:img:src" content="https://effectivetypescript.com/images/cover.jpg">

    <meta property="og:title" content="Effective TypeScript &rsaquo; Generic Tips Part 2: Intersect what you have with whatever TypeScript wants">
    <meta property="og:description" content="When you&#39;re working with generic types and run into a seemingly unavoidable error, there&#39;s a trick that can often make it go away: intersect what you have with whatever TypeScript wants it to be. Your errors will melt away! Read on for examples and caveats.
">
    <meta property="og:image" content="https://effectivetypescript.com/images/cover.jpg">
    <meta property="og:url" content="https://effectivetypescript.com/">

    <link href="https://effectivetypescript.com/atom.xml" type="application/atom+xml" rel="alternate" title="Effective TypeScript Atom Feed">
  <meta name="generator" content="Hexo 5.4.0"></head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1NXE8EL9YT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1NXE8EL9YT');
  var trackOutboundLink = function(category, url, e) {
    if (!window.google_tag_manager) {
      console.log('blocked!');
      return true;  // probably blocked
    }

    // No need to use event_callback if the link is opening in a new tab.
    var newTab = e && (e.metaKey || (e.currentTarget && e.currentTarget.target === '_blank'));
    gtag('event', 'click', {
        'event_category': category,
        'event_label': url,
        'transport_type': 'beacon',
        'event_callback': !newTab ? function() {
          document.location = url;
        } : undefined
    });

    return newTab;
  }
</script>

<body class="post">
  <div class="header">
  <div class="container">
      <div class="row">
          <div class="col-md-12">
              <h1 class="site-title">
                  <a href="/">
                      Effective TypeScript
                  </a>
              </h1>
          </div>
      </div>
  </div>
</div>

  <section id="content" class="article content">

  <div class="title-bar">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h2>Generic Tips Part 2: Intersect what you have with whatever TypeScript wants</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="page-content">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="text-muted published-container">
            <time class="published" datetime="2020-12-09T22:50:00.000Z" itemprop="datePublished">
              Wed 09 December 2020
            </time>
          </div>
          <div class="entry-content">
            <p><em>This is part of an ongoing series on tips I learned for working with TypeScript generics from building the <a target="_blank" rel="noopener" href="https://github.com/danvk/crosswalk" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://github.com/danvk/crosswalk', event);">crosswalk</a> library. Check out <a href="/2020/12/04/gentips-1-curry/">part 1</a> for more background.</em></p>
<ul>
<li>Part 0: <a href="/2020/08/12/generics-golden-rule/">The Golden Rule of Generics</a></li>
<li>Part 1: <a href="/2020/12/04/gentips-1-curry/">Use Classes and Currying to create new inference sites</a></li>
<li>Part 2: Intersect what you have with whatever TypeScript wants</li>
<li>Part 3: <a href="/2021/01/20/gentips-3-aliases/">Avoid Repeating Type Expressions</a></li>
<li>Part 4: <a href="https://effectivetypescript.com/2022/02/25/gentips-4-display/">The Display of Types</a></li>
</ul>
<p>Recall that an API definition in <a target="_blank" rel="noopener" href="https://github.com/danvk/crosswalk" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://github.com/danvk/crosswalk', event);">crosswalk</a> looks something like this:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> API &#123;<br>  <span class="hljs-string">&#x27;/users&#x27;</span>: &#123;<br>    get: GetEndpoint&lt;UsersResponse&gt;;<br>    post: Endpoint&lt;CreateUserRequest, User&gt;;<br>  &#125;;<br>  <span class="hljs-string">&#x27;/users/:userId&#x27;</span>: &#123;<br>    get: GetEndpoint&lt;User&gt;;<br>    put: Endpoint&lt;UpdateUser, User&gt;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(<code>Endpoint</code> and <code>GetEndpoint</code> are simple type aliases <a target="_blank" rel="noopener" href="https://github.com/danvk/crosswalk/blob/c63c9ef5a55b42c275f4f701c21d8eb03ae9ca5e/src/api-spec.ts#L1-L6" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://github.com/danvk/crosswalk/blob/c63c9ef5a55b42c275f4f701c21d8eb03ae9ca5e/src/api-spec.ts#L1-L6', event);">defined by the library</a>. Their parameters are request and response types.)</p>
<p>In <a href="/2020/12/04/gentips-1-curry/">last week&#39;s post</a> we defined a <code>getUrl</code> function to safely generate API URLs. In this week&#39;s post, we&#39;ll create type-safe wrappers around <a target="_blank" rel="noopener" href="https://expressjs.com/" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://expressjs.com/', event);">express</a> methods to handle these endpoints.</p>
<p>Here&#39;s how you typically register a <code>get</code> handler in express:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">app.get(<span class="hljs-string">&#x27;/users/:userId&#x27;</span>, <span class="hljs-keyword">async</span> (request, response) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123;userId&#125; = request.params;<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> getUserById(userId);<br>  response.json(user);<br>  <span class="hljs-comment">// (error handling omitted)</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<p>There are a few issues with this from a TypeScript perspective:</p>
<ol>
<li>The type of <code>request.params</code> is <code>any</code>. This means that <code>userId</code> also gets an <code>any</code> type, and this destructuring assignment is completely unsafe.</li>
<li>The call to <code>response.json()</code> doesn&#39;t check the type of its argument. In fact, nothing checks that we call <code>response.json</code> at all.</li>
</ol>
<p>Crosswalk defines a typed wrapper so that the registration looks like this:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> typedRouter = <span class="hljs-keyword">new</span> TypedRouter&lt;API&gt;(app);<br>typedRouter.get(<br>  <span class="hljs-string">&#x27;/users/:userId&#x27;</span>,<br>  <span class="hljs-keyword">async</span> params =&gt; getUserById(params.userId)<br>);<br></code></pre></td></tr></table></figure>

<p>Instead of using <code>response.json</code> to send a response, we return <code>Promise&lt;User&gt;</code>, which TypeScript checks against the <code>API</code> interface. Additionally, thanks to <a href="/2020/11/05/template-literal-types/">the magic of <code>ExtractRouteParams</code></a>, <code>params</code> has an inferred type of <code>&#123;userId: string&#125;</code>, so the reference to <code>params.userId</code> is type safe.</p>
<p>Let&#39;s take a crack at implementing <code>TypedRouter</code>. As <a href="/2020/12/04/gentips-1-curry/">last week&#39;s tip</a> explained, you can either use a class or a <a target="_blank" rel="noopener" href="https://wiki.haskell.org/Currying" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://wiki.haskell.org/Currying', event);">curried function</a> to capture the <code>API</code> type parameter. In this case let&#39;s use a class. Then we can use a method (<code>get</code>) that infers a string literal type for the path. Here&#39;s a sketch:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypedRouter</span>&lt;<span class="hljs-title">API</span>&gt; </span>&#123;<br>  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> router: express.Router</span>)</span> &#123;&#125;<br>  get&lt;Path <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;(<br>    path: Path,<br>    handler: (<br>      params: ExtractRouteParams&lt;Path&gt;,<br>    ) =&gt; <span class="hljs-built_in">Promise</span>&lt;unknown&gt;  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> fill in this type!</span><br>  ) &#123;<br>    <span class="hljs-built_in">this</span>.router.get(path, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>      handler(request.params)<br>      .then(<span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> response.json(obj));<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>This gets us some of the way there: the <code>params</code> parameter to our handler is getting the correct type:</p>
<p><img src="https://effectivetypescript.com/images/gentips-2-inferred-params.png" alt="path parameters being inferred"></p>
<p>But what about that return type? Really you&#39;d like to look it up from the <code>API</code> interface given <code>Path</code>.</p>
<p>Here&#39;s how you&#39;d do that with a type alias:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Response = API[<span class="hljs-string">&#x27;/users/:userId&#x27;</span>][<span class="hljs-string">&#x27;get&#x27;</span>][<span class="hljs-string">&#x27;response&#x27;</span>];<br><span class="hljs-comment">// type is User</span><br></code></pre></td></tr></table></figure>

<p>If you plug that into our <code>get</code> function, however, you get several errors:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">get&lt;Path <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;(<br>  path: Path,<br>  handler: (<br>    params: ExtractRouteParams&lt;Path&gt;,<br>  ) =&gt; <span class="hljs-built_in">Promise</span>&lt;API[Path][<span class="hljs-string">&#x27;get&#x27;</span>][<span class="hljs-string">&#x27;response&#x27;</span>]&gt;<br>  <span class="hljs-comment">//           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br>  <span class="hljs-comment">// Type &#x27;Path&#x27; cannot be used to index type &#x27;API&#x27;. (2536)</span><br>  <span class="hljs-comment">// Type &#x27;&quot;get&quot;&#x27; cannot be used to index type &#x27;API[Path]&#x27;. (2536)</span><br>  <span class="hljs-comment">// Type &#x27;&quot;response&quot;&#x27; cannot be used to index type &#x27;API[Path][&quot;get&quot;]&#x27;. (2536)</span><br>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>It&#39;s reasonable for TypeScript to complain here. We haven&#39;t constrained <code>API</code> or <code>Path</code>, so it has no reason to believe that <code>Path</code> is defined on <code>API</code>, let alone that it has a <code>get</code> property which has a <code>response</code> property.</p>
<p>You can fix the first of these errors by changing:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs plain">- get&lt;Path extends string&gt;(<br>+ get&lt;Path extends keyof API&gt;(<br></code></pre></td></tr></table></figure>

<p>Unfortunately, this introduces a <em>new</em> error:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-built_in">this</span>.router.get(path, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br><span class="hljs-comment">//              ~~~~</span><br><span class="hljs-comment">// Type &#x27;string | number | symbol&#x27; is not assignable to type &#x27;(string | RegExp)[]&#x27;.</span><br></code></pre></td></tr></table></figure>

<p>(The full error is quite long, but that&#39;s the important part.)</p>
<p>The problem is that express wants the <code>path</code> parameter to be a <code>string</code> (or a <code>RegExp</code>), but in TypeScript, <code>keyof API</code> is a <code>PropertyKey</code>, which is <a target="_blank" rel="noopener" href="https://github.com/microsoft/TypeScript/blob/4dc82fdfba577085a087db6535a4ad2cc755e503/lib/lib.es5.d.ts#L105" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://github.com/microsoft/TypeScript/blob/4dc82fdfba577085a087db6535a4ad2cc755e503/lib/lib.es5.d.ts#L105', event);">defined in the standard library</a> as:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">type</span> PropertyKey = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | symbol;<br></code></pre></td></tr></table></figure>

<p>The <code>number</code> is a lie (Item 16 of <a target="_blank" rel="noopener" href="https://amzn.to/3HIrQN6" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://amzn.to/3HIrQN6', event);"><em>Effective TypeScript</em></a>, &quot;Prefer Arrays, Tuples, and ArrayLike to number Index Signatures&quot;, explains this in great detail). But <code>path</code> could certainly be a <code>string</code> or <code>symbol</code>. We don&#39;t care about the <code>symbol</code> or <code>number</code> cases, though. We only want the <code>string</code>. To get down to this, you can use an intersection type:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs plain">- get&lt;Path extends keyof API&gt;(<br>+ get&lt;Path extends keyof API &amp; string&gt;(<br></code></pre></td></tr></table></figure>

<p>This eliminates the error with <code>router.get</code>! This intersection trick winds up being an extremely useful way to get rid of TypeScript errors with generics. As it turns out, it&#39;s this week&#39;s tip!</p>
<p><strong>To get rid of generic type errors, intersect what you have with whatever TypeScript wants.</strong></p>
<p>Let&#39;s use the same trick to get rid of the remaining two errors:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs plain">Promise&lt;API[Path][&#39;get&#39;][&#39;response&#39;]&gt;<br>&#x2F;&#x2F;      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>&#x2F;&#x2F; Type &#39;&quot;get&quot;&#39; cannot be used to index type &#39;API[Path]&#39;. (2536)<br>&#x2F;&#x2F; Type &#39;&quot;response&quot;&#39; cannot be used to index type &#39;API[Path][&quot;get&quot;]&#39;. (2536)<br></code></pre></td></tr></table></figure>

<p>In the first error, TypeScript is saying that it&#39;s seeing <code>&#39;get&#39;</code>, but it wants something that can index <code>API[Path]</code>. In other words, <code>keyof API[Path]</code>. So let&#39;s intersect!</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs plain">Promise&lt;API[Path][&#39;get&#39; &amp; keyof API[Path]][&#39;response&#39;]&gt;<br>&#x2F;&#x2F;      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>&#x2F;&#x2F; Type &#39;&quot;response&quot;&#39; cannot be used to index type &#39;API[Path][&quot;get&quot; &amp; keyof API[Path]]&#39;. (2536)&#96;&#96;&#96;<br><br>Voila! The error is gone! It&#39;s like magic. You can get rid of the remaining error using the same trick. Watch out, this is going to get a little wordy:<br><br>&#96;&#96;&#96;ts<br>Promise&lt;API[Path][&#39;get&#39; &amp; keyof API[Path]][&#39;response&#39; &amp; keyof API[Path][&quot;get&quot; &amp; keyof API[Path]]]&gt;<br></code></pre></td></tr></table></figure>

<p>And the errors are gone! What&#39;s more, we have perfect type inference. The error if you return the wrong type from a handler is exactly what you&#39;d hope for:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">typedRouter.get(<br>  <span class="hljs-string">&#x27;/users/:userId&#x27;</span>,<br>  <span class="hljs-keyword">async</span> params =&gt; <span class="hljs-literal">null</span><br>  <span class="hljs-comment">//              ~~~~</span><br>  <span class="hljs-comment">// Type &#x27;Promise&lt;null&gt;&#x27; is not assignable to type &#x27;Promise&lt;User&gt;&#x27;.</span><br>  <span class="hljs-comment">//   Type &#x27;null&#x27; is not assignable to type &#x27;User&#x27;. (2322)</span><br>);<br></code></pre></td></tr></table></figure>

<p>But this a mess. The issue is that for every index operator, you also have to introduce a <code>keyof</code>. And with three index operators (<code>Path</code>, <code>&#39;get&#39;</code>, <code>&#39;response&#39;</code>), this has spiraled out of control.</p>
<p>You can improve things with a short helper:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> LooseKey&lt;T, K&gt; = T[K &amp; keyof T];<br></code></pre></td></tr></table></figure>

<p>This is like <code>T[K]</code> except that it doesn&#39;t require evidence that <code>K</code> is actually a key of <code>T</code>. (If it&#39;s not, it will resolve to <code>never</code>.) The win here is that while <code>T</code> appears twice in the definition of <code>LooseKey</code>, it only appears once when you use it. Here&#39;s how you can use it to simplify the monstrous type expression from earlier:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs plain">- Promise&lt;API[Path][&#39;get&#39; &amp; keyof API[Path]][&#39;response&#39; &amp; keyof API[Path][&quot;get&quot; &amp; keyof API[Path]]]&gt;<br>+ Promise&lt;LooseKey&lt;LooseKey&lt;API[Path], &#39;get&#39;&gt;, &#39;response&#39;&gt;&gt;<br></code></pre></td></tr></table></figure>

<p>As before, this still resolves all our types perfectly. You could even define a <code>LooseKey2</code> to simplify things a bit more:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> LooseKey&lt;T, K&gt; = T[K &amp; keyof T];<br><span class="hljs-keyword">type</span> LooseKey2&lt;T, K1, K2&gt; = LooseKey&lt;LooseKey&lt;T, K1&gt;, K2&gt;;<br><br><span class="hljs-built_in">Promise</span>&lt;LooseKey2&lt;API[Path], <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;response&#x27;</span>&gt;&gt;<br></code></pre></td></tr></table></figure>

<p>(You could define a variadic version of this that works on tuples of keys. Give it a try!)</p>
<p>This technique also comes in handy with <a target="_blank" rel="noopener" href="https://github.com/microsoft/TypeScript/pull/40336" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://github.com/microsoft/TypeScript/pull/40336', event);">template literal types</a>. For example, let&#39;s define a generic type that capitalizes the property names of another type. You can do this using the built-in <code>Capitalize</code> generic and a mapped type:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Caps&lt;T&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof T <span class="hljs-keyword">as</span> Capitalize&lt;K&gt;]: T[K];<br>  <span class="hljs-comment">//                          ~</span><br>  <span class="hljs-comment">// Type &#x27;K&#x27; does not satisfy the constraint &#x27;string&#x27;.</span><br>  <span class="hljs-comment">//   Type &#x27;keyof T&#x27; is not assignable to type &#x27;string&#x27;.</span><br>  <span class="hljs-comment">//     Type &#x27;string | number | symbol&#x27; is not assignable to type &#x27;string&#x27;.</span><br>  <span class="hljs-comment">//       Type &#x27;number&#x27; is not assignable to type &#x27;string&#x27;. (2344)</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>This looks familiar! TypeScript wants a <code>string</code>, but we&#39;ve got a <code>PropertyKey</code>. By now you should see how to solve the problem: intersect with whatever TS wants!</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Caps&lt;T&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof T <span class="hljs-keyword">as</span> Capitalize&lt;K &amp; <span class="hljs-built_in">string</span>&gt;]: T[K];<br>&#125;<br></code></pre></td></tr></table></figure>

<p>and now this works as you&#39;d expect:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> T = Caps&lt;&#123;<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>&#125;&gt;;<br><span class="hljs-comment">// type T = &#123;</span><br><span class="hljs-comment">//     Name: string;</span><br><span class="hljs-comment">//     Age: number;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure>

<p>Of course, there&#39;s no free lunch. The downside of this approach is that TypeScript won&#39;t check that the property accesses in your generic are safe. You&#39;ll need to verify them in some other way, <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=nygcFEwOG8w" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://www.youtube.com/watch?v=nygcFEwOG8w', event);">probably with a test</a>. But it&#39;s undeniably convenient to have this safety valve available! You can think of it as a rough equivalent of <code>as any</code> for generic types.</p>
<p>Here&#39;s our final version of <code>TypedAPI</code>:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypedRouter</span>&lt;<span class="hljs-title">API</span>&gt; </span>&#123;<br>  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> router: express.Router</span>)</span> &#123;&#125;<br>  get&lt;Path <span class="hljs-keyword">extends</span> keyof API &amp; <span class="hljs-built_in">string</span>&gt;(<br>    path: Path,<br>    handler: (<br>      params: ExtractRouteParams&lt;Path&gt;,<br>    ) =&gt; <span class="hljs-built_in">Promise</span>&lt;LooseKey2&lt;API[Path], <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;response&#x27;</span>&gt;&gt;<br>  ) &#123;<br>    <span class="hljs-built_in">this</span>.router.get(path, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>      handler(request.params)<br>      .then(<span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> response.json(obj));<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>As usual, you can find the <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAKjgQwM5wKYA8xQ69AMyghDgHJtd9VyBuAKAaunmADsYMpDkBjDHACi7ACaQOMADwAlDAEcArvhgAaOHNSR2qDAD44AbwZw4eJSoBcGhctQxGpvFog6M1zdt2MAvsxyscDAAnmCCAOIYMCLiEJKy+F76cAC8wmISnFLsigA2ueqerrp6jAyS3LwCcACqulBGQaHuFIr19HB+FTz8gnXcqEVujW0D1v1QANoAunSd5ZyVvXAAwnjIXBNyFvaN7MggLfZQHADmc12LPdU1YKIbGBN7BxgA-NbHZ51lAPQ-cABlDCCAAWMBgYFQlj+p2AMBBigARgA6PikH73dgANwA1j8+CQCAB3ZC5HH+SCwODdKqCACCAAUAJJGEwUH6jKC0azGUymU5RayRaIZOJZCaDRLFfSOPmQezWGKZaRrDAPLa2FTqCalNk+WXkDn1VA-Sycpmicg8tn8wVwYVKsXSHWy0xgRQwRWi+K3e6bera+q60x+PwMP6A4FwMEQ6E-XIQPikkEQBUAFgADFmfgAmDN5n4ARkLPwzAFYflxwLkHgBaXJw7ik2shMImimBVuCIRYGBQfgwGQQD0YBnIfsgVBSAAqBjSn3Yp0wvYwYnQ07ZrxsaKgoikC9O6gPejZ1mny64a7gAAMACSGDiEbhwAD6AJg45gPks98fz7HE4+D8v7sE+DSaF+16bo0kw4tS7BwABBxwAAPnAOIYMEECEMIvb9nwg7DlwSGTgk9h6NMHx9l8fimGeF6rqI6B3g+oHPm+H6wN+IFgYh44HD4UGmFuhhwLB8F8ROlFwAe8x0UY+pMKIGB8DWeBwLkUQoGAYDWFQzioMiQ4jlAjDKap46CIQijsARwCuHAAowBMABCwQWgAFOaohUSci4AJTWAyJAgMAuhSC6TBdjYLjDGkjJMpMhqciaZr1Ba5DTElTmZUlzhJJljARtFYW1PUUXNHAAAyECphgADSmEzuo9VznA06TPVcAAGToZh2HtbMDDRTVdWNcEObNXA9WFi1OZtaNujjVIi0NU104tYWehzbqDAWQQ7XNKIxlcFAUgJQYvJwGiOh9ooBHQB5uDAFiDxmER3B6TgBlGR9UD+QpbJOVIY7wgxV4YVhOEJT1MnUYuegeTacBgBsIJBWjqjIyCyBiJpUDWEjfJyvxk6KnhA4naOpNTqDILbcjAMpAYwWkGFGArbVS2YZNCWTHT0zqOQOVC-l0rkHoJ6mADV2mPCYXIiQJnIk5T2Y3AHnmHYahmFKbhM5dyOmDjePcJrmr2MiqMTqg-lG3AyLwquHkQIiABWqQGGLbjIm7qCuC77v+f5rqdHbIYMGGN27F2x1-akcDsBgRKHWEccmedzKI8gOkh8NR1U1AKtRET7Ipaa3nkFjphoMEtkozTnuOVErnuaIas28i3l23n+dhKsOdTrOCdXZ1EmQwN55oAPYBwqSwAAF4c11vXHtJHX1dMkcVf355pCsg9SIY+yHL5ZzqMgArWDkICItwPi6sVlV76yEbEwAci8Z+LkV-zE3SV9E6KFvtwX+8wgA" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAKjgQwM5wKYA8xQ69AMyghDgHJtd9VyBuAKAaunmADsYMpDkBjDHACi7ACaQOMADwAlDAEcArvhgAaOHNSR2qDAD44AbwZw4eJSoBcGhctQxGpvFog6M1zdt2MAvsxyscDAAnmCCAOIYMCLiEJKy+F76cAC8wmISnFLsigA2ueqerrp6jAyS3LwCcACqulBGQaHuFIr19HB+FTz8gnXcqEVujW0D1v1QANoAunSd5ZyVvXAAwnjIXBNyFvaN7MggLfZQHADmc12LPdU1YKIbGBN7BxgA-NbHZ51lAPQ-cABlDCCAAWMBgYFQlj+p2AMBBigARgA6PikH73dgANwA1j8+CQCAB3ZC5HH+SCwODdKqCACCAAUAJJGEwUH6jKC0azGUymU5RayRaIZOJZCaDRLFfSOPmQezWGKZaRrDAPLa2FTqCalNk+WXkDn1VA-Sycpmicg8tn8wVwYVKsXSHWy0xgRQwRWi+K3e6bera+q60x+PwMP6A4FwMEQ6E-XIQPikkEQBUAFgADFmfgAmDN5n4ARkLPwzAFYflxwLkHgBaXJw7ik2shMImimBVuCIRYGBQfgwGQQD0YBnIfsgVBSAAqBjSn3Yp0wvYwYnQ07ZrxsaKgoikC9O6gPejZ1mny64a7gAAMACSGDiEbhwAD6AJg45gPks98fz7HE4+D8v7sE+DSaF+16bo0kw4tS7BwABBxwAAPnAOIYMEECEMIvb9nwg7DlwSGTgk9h6NMHx9l8fimGeF6rqI6B3g+oHPm+H6wN+IFgYh44HD4UGmFuhhwLB8F8ROlFwAe8x0UY+pMKIGB8DWeBwLkUQoGAYDWFQzioMiQ4jlAjDKap46CIQijsARwCuHAAowBMABCwQWgAFOaohUSci4AJTWAyJAgMAuhSC6TBdjYLjDGkjJMpMhqciaZr1Ba5DTElTmZUlzhJJljARtFYW1PUUXNHAAAyECphgADSmEzuo9VznA06TPVcAAGToZh2HtbMDDRTVdWNcEObNXA9WFi1OZtaNujjVIi0NU104tYWehzbqDAWQQ7XNKIxlcFAUgJQYvJwGiOh9ooBHQB5uDAFiDxmER3B6TgBlGR9UD+QpbJOVIY7wgxV4YVhOEJT1MnUYuegeTacBgBsIJBWjqjIyCyBiJpUDWEjfJyvxk6KnhA4naOpNTqDILbcjAMpAYwWkGFGArbVS2YZNCWTHT0zqOQOVC-l0rkHoJ6mADV2mPCYXIiQJnIk5T2Y3AHnmHYahmFKbhM5dyOmDjePcJrmr2MiqMTqg-lG3AyLwquHkQIiABWqQGGLbjIm7qCuC77v+f5rqdHbIYMGGN27F2x1-akcDsBgRKHWEccmedzKI8gOkh8NR1U1AKtRET7Ipaa3nkFjphoMEtkozTnuOVErnuaIas28i3l23n+dhKsOdTrOCdXZ1EmQwN55oAPYBwqSwAAF4c11vXHtJHX1dMkcVf355pCsg9SIY+yHL5ZzqMgArWDkICItwPi6sVlV76yEbEwAci8Z+LkV-zE3SV9E6KFvtwX+8wgA', event);">full code</a> for this post on the TypeScript playground.</p>
<p>Next week we&#39;ll add the express Request and Response objects to the callback and look at ways to mitigate the repetition of types that follows.</p>

          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="follow-or-subscribe">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          Like this post? Consider subscribing to
          <a href="/mail/" onclick="return trackOutboundLink('subscribe newsletter', '/mail/', event);">my newsletter</a>,
          the <a href="/atom.xml" onclick="return trackOutboundLink('follow RSS', '/atom.xml', event);">RSS feed</a>,
          or <a target="_blank" rel="noopener" href="https://twitter.com/danvdk" onclick="return trackOutboundLink('follow on twitter', 'https://twitter.com/danvdk', event);">following me</a>
          on Twitter.
        </div>
      </div>
    </div>
  </div>

  <div class="comments">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <script src="https://utteranc.es/client.js" repo="danvk/effective-typescript" issue-term="title" label="ðŸ’¬ blog comments" theme="github-light" crossorigin="anonymous" async>
          </script>
        </div>
      </div>
    </div>
  </div>

  <div class="promotion">
    <div class="row">
      <div class="col-sm-12 text-center">
        <a target="_blank" rel="noopener" href="https://amzn.to/3HIrQN6" class="btn btn-info btn-lg primary" onclick="return trackOutboundLink('post learn more hover', 'https://amzn.to/3HIrQN6', event);">Buy the Book</a>
        <a target="_blank" rel="noopener" href="https://www.ebooks.com/en-us/209820951/effective-typescript/dan-vanderkam/?_c=1" class="btn btn-info btn-lg hidden-xs" onclick="return trackOutboundLink('post learn more hover', 'https://www.ebooks.com/en-us/209820951/effective-typescript/dan-vanderkam/?_c=1', event);">Buy eBook</a>
        <a href="/mail/" class="btn btn-info btn-lg" onclick="return trackOutboundLink('post learn more hover', '/mail/', event);">Subscribe</a>
      </div>
    </div>
  </div>

  <div class="page-content">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <a target="_blank" rel="noopener" href="https://amzn.to/3HIrQN6" onclick="return trackOutboundLink('post learn more cover image', 'https://amzn.to/3HIrQN6', event);">
            <img src="/images/cover.jpg" class="learn-more-photo" alt="Effective TypeScript Book Cover">
          </a>
          <p><strong><em>Effective TypeScript</em></strong> shows you not just <em>how</em> to use TypeScript but how to use it <em>well</em>. The book&#39;s 62 items help you build mental models of how TypeScript and its ecosystem work, make you aware of pitfalls and traps to avoid, and guide you toward using TypeScriptâ€™s many capabilities in the most effective ways possible. Regardless of your level of TypeScript experience, you can learn something from this book.</p>
<p>After reading <em>Effective TypeScript</em>, your relationship with the type system will be the most productive it&#39;s ever been! <a href="/">Learn more Â»</a></p>

        </div>
      </div>
    </div>
  </div>

</section>

  <footer id="contentinfo" class="footer">
  <div class="container">
    <address id="about" class="vcard body">
      &copy; 2019 - 2023 <a class="url fn" target="_blank" rel="noopener" href="https://danvk.org" onclick="trackOutboundLink('footer', 'https://danvk.org'); return false;">Dan Vanderkam</a>
      <div class="footer-attribution">Powered by <a href="https://hexo.io/" target="_blank" onclick="return trackOutboundLink('generic tips part  intersect what you have with whatever typescript wants', 'https://hexo.io/', event);">Hexo</a></div>
    </address>
  </div>
</footer>
</body>
</html>
